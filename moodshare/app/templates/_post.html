{#
    POST COMPONENT
    ==============

    COMPONENT PATTERN EXPLAINED:
    ----------------------------
    The underscore prefix (_post.html) indicates this is a "partial" or "component".
    It's not meant to be rendered directly - it's included in other templates.

    Usage: {% include '_post.html' %}

    This template expects a 'post' variable to be in scope when included.
    The post object has:
    - post.author (User object)
    - post.author.username
    - post.author.avatar(size)
    - post.body (the post content)
    - post.timestamp (when posted)
    - post.like_count() (number of likes)
    - post.is_liked_by(user) (check if user liked this post)

    WHY USE COMPONENTS?
    - DRY (Don't Repeat Yourself) - same card used on index, profile, explore
    - Easy to update styling in ONE place
    - Consistent look across the app
#}

<article class="flex gap-4 p-4 border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-[#1f1f1f] transition-colors">
    {# Avatar - links to user profile #}
    <a href="{{ url_for('user', username=post.author.username) }}" class="flex-shrink-0">
        <img src="{{ post.author.avatar(48) }}"
             alt="{{ post.author.username }}'s avatar"
             class="w-12 h-12 rounded-full hover:opacity-80 transition-opacity">
    </a>

    {# Post content #}
    <div class="flex-1 min-w-0">
        {# Header: username + timestamp #}
        <div class="flex items-center gap-2 mb-1">
            <a href="{{ url_for('user', username=post.author.username) }}"
               class="font-semibold text-warm-black dark:text-white hover:underline">
                {{ post.author.username }}
            </a>
            {#
                FLASK-MOMENT EXPLAINED:
                -----------------------
                moment() is provided by Flask-Moment extension.
                .fromNow() converts timestamp to "5 minutes ago" format.
                This is client-side JS that updates automatically!
            #}
            <span class="text-sm text-gray-500 dark:text-gray-500">
                {{ moment(post.timestamp).fromNow() }}
            </span>
        </div>

        {# Post body #}
        <p class="text-warm-black dark:text-gray-200 whitespace-pre-wrap break-words">{{ post.body }}</p>

        {# POST ACTIONS #}
        <div class="flex items-center gap-6 mt-3">
            {#
                LIKE BUTTON
                -----------
                This is a form that POSTs to like/unlike routes.

                WHY USE A FORM?
                - Forms can submit POST requests
                - Buttons outside forms can only do GET (clicking a link)
                - We need POST for actions that change data

                CONDITIONAL RENDERING:
                - If user already liked: show filled heart + unlike route
                - If user hasn't liked: show outline heart + like route
            #}
            {% if post.is_liked_by(current_user) %}
                {# Unlike form - user has already liked this post #}
                <form action="{{ url_for('unlike_post', post_id=post.id) }}" method="POST" class="inline">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit"
                            class="flex items-center gap-1.5 text-red-500 hover:text-red-600 transition-colors group">
                        {# Filled heart icon #}
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                            </path>
                        </svg>
                        <span class="text-sm">{{ post.like_count() }}</span>
                    </button>
                </form>
            {% else %}
                {# Like form - user hasn't liked this post yet #}
                <form action="{{ url_for('like_post', post_id=post.id) }}" method="POST" class="inline">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit"
                            class="flex items-center gap-1.5 text-gray-500 hover:text-red-500 transition-colors group">
                        {# Outline heart icon #}
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                  d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                            </path>
                        </svg>
                        <span class="text-sm">{{ post.like_count() }}</span>
                    </button>
                </form>
            {% endif %}

            {#
                DELETE BUTTON
                -------------
                Only shown if the post belongs to the current user.
                This is AUTHORIZATION - checking permissions before showing action.
                Will be made functional in Phase 4.
            #}
            {% if post.author == current_user %}
                <form action="{{ url_for('delete_post', post_id=post.id) }}" method="POST" class="inline"
                      onsubmit="return confirm('Are you sure you want to delete this post?');">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit"
                            class="flex items-center gap-1.5 text-gray-500 hover:text-red-500 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                            </path>
                        </svg>
                    </button>
                </form>
            {% endif %}
        </div>
    </div>
</article>
